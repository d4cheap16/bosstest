<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOSS Sprite Previewer (Multi-Frame)</title>
    <style>
        body {
            background-color: #111; color: #ddd; font-family: monospace;
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }
        /* é è¦½å€ */
        #stage {
            flex: 1; display: flex; align-items: flex-end; justify-content: center;
            background: radial-gradient(circle, #222 0%, #000 100%);
            padding-bottom: 50px; border-bottom: 2px solid #500; position: relative;
        }
        /* åœ–ç‰‡æœ¬é«” (åƒç´ é¢¨æ ¼è¨­å®š) */
        #boss-img {
            image-rendering: pixelated; transition: width 0.1s, filter 0.1s;
            width: 150px; /* åˆå§‹å¤§å° */
        }
        /* è³‡è¨Šæ–‡å­— */
        #info { position: absolute; top: 10px; left: 10px; font-size: 12px; color: #666; }
        
        /* æ§åˆ¶å€ */
        #controls {
            background: #222; padding: 15px; border-top: 1px solid #444;
            display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;
        }
        button, label {
            padding: 8px 16px; background: #333; border: 1px solid #555; color: #fff;
            cursor: pointer; font-size: 14px; border-radius: 4px;
        }
        button:hover, label:hover { background: #444; border-color: #888; }
        button:active { transform: scale(0.95); }
        input[type="file"] { display: none; }

        /* ç‰¹æ•ˆå‹•ç•« */
        .shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        .flash { filter: brightness(10) sepia(1) hue-rotate(-50deg) saturate(5) !important; }
        
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }
    </style>
</head>
<body>

    <div id="stage">
        <div id="info">Z-Depth: <span id="z-val">0.2</span> | Frame: <span id="f-val">1</span></div>
        <img id="boss-img" src="" alt="BOSS (Please Upload)" onerror="this.style.opacity=0.3">
    </div>

    <div id="controls">
        <!-- æª”æ¡ˆè¼‰å…¥ -->
        <label>ğŸ“‚ å¾…æ©Ÿåœ–1 (Idle 1) <input type="file" onchange="loadImg(this, 'idle', 0)"></label>
        <label>ğŸ“‚ å¾…æ©Ÿåœ–2 (Idle 2) <input type="file" onchange="loadImg(this, 'idle', 1)"></label>
        
        <span style="border-left: 1px solid #555; margin: 0 5px;"></span>

        <label>ğŸ“‚ æ”»æ“Šåœ– (Attack) <input type="file" onchange="loadImg(this, 'attack', 0)"></label>
        
        <span style="border-left: 1px solid #555; margin: 0 5px;"></span>

        <!-- å‹•ä½œæ¸¬è©¦ -->
        <button onclick="changeZ(0.1)">â« å‰é€²</button>
        <button onclick="changeZ(-0.1)">â¬ å¾Œé€€</button>
        <button onclick="toggleState()" id="btn-state">åˆ‡æ›: å¾…æ©Ÿ</button>
        <button onclick="triggerDamage()" style="color:#f88; border-color:#844">ğŸ’¥ å—å‚·æ¸¬è©¦</button>
    </div>

    <script>
        const imgEl = document.getElementById('boss-img');
        const zEl = document.getElementById('z-val');
        const fEl = document.getElementById('f-val');
        const btnState = document.getElementById('btn-state');
        
        // åœ–ç‰‡è³‡æºåº«
        const assets = {
            idle: [null, null], // æ”¯æ´ 2 å¼µå¾…æ©Ÿåœ–
            attack: [null]      // 1 å¼µæ”»æ“Šåœ–é€šå¸¸å°±å¤ äº† (æˆ–è€…ä¹Ÿå¯ä»¥æ“´å……)
        };
        
        let z = 0.2;
        let isIdle = true;
        let frameIndex = 0;
        let animationInterval = null;

        // è¼‰å…¥åœ–ç‰‡
        function loadImg(input, type, index) {
            if (input.files && input.files[0]) {
                const url = URL.createObjectURL(input.files[0]);
                assets[type][index] = url;
                
                // å¦‚æœæ˜¯ç¬¬ä¸€å¼µåœ–ï¼Œç«‹åˆ»æ›´æ–°é¡¯ç¤º
                if (imgEl.getAttribute('src') === "" || imgEl.getAttribute('src') === null) {
                    updateView();
                    startAnimation();
                }
            }
        }

        // å‹•ç•«å¾ªç’°é‚è¼¯
        function startAnimation() {
            if (animationInterval) clearInterval(animationInterval);
            
            // æ¯ 500ms åˆ‡æ›ä¸€æ¬¡ (æ¨¡æ“¬èµ°è·¯ç¯€å¥)
            animationInterval = setInterval(() => {
                if (isIdle) {
                    // åœ¨å¾…æ©Ÿåœ– 1 å’Œ 2 ä¹‹é–“åˆ‡æ›
                    frameIndex = (frameIndex + 1) % 2; 
                    updateView();
                }
            }, 500);
        }

        // æ›´æ–°åœ–ç‰‡é¡¯ç¤º
        function updateView() {
            let src = "";
            
            if (isIdle) {
                // å¦‚æœç¼ºåœ–ï¼Œè‡ªå‹• fallback åˆ°ç¬¬ä¸€å¼µ
                src = assets.idle[frameIndex] || assets.idle[0];
            } else {
                src = assets.attack[0] || assets.idle[0]; // å¦‚æœæ²’æ”»æ“Šåœ–ï¼Œç”¨å¾…æ©Ÿåœ–
            }

            if (src) {
                imgEl.src = src;
                imgEl.style.opacity = 1;
                fEl.innerText = frameIndex + 1;
            } else {
                imgEl.alt = "è«‹ä¸Šå‚³åœ–ç‰‡";
            }
        }

        // æ¨¡æ“¬ Z è»¸ç§»å‹•
        function changeZ(delta) {
            z = Math.max(0.05, Math.min(1.5, z + delta));
            const width = 50 + (z * z * 400); 
            imgEl.style.width = width + "px";
            zEl.innerText = z.toFixed(2);
        }

        // åˆ‡æ›ç‹€æ…‹
        function toggleState() {
            isIdle = !isIdle;
            btnState.innerText = isIdle ? "åˆ‡æ›: å¾…æ©Ÿ (Idle)" : "åˆ‡æ›: æ”»æ“Š (Attack)";
            // æ”»æ“Šæ™‚é€šå¸¸ä¸æ’­èµ°è·¯å‹•ç•«ï¼Œæˆ–æ˜¯æ’­æ”»æ“Šå‹•ç•« (é€™è£¡ç°¡åŒ–ç‚ºå–®å¼µ)
            updateView();
        }

        // å—å‚·ç‰¹æ•ˆ
        function triggerDamage() {
            const oldState = isIdle;
            isIdle = false; // ç¬é–“åˆ‡æ›æ”»æ“Šå§¿æ…‹
            updateView();

            imgEl.classList.add('shake', 'flash');

            setTimeout(() => {
                imgEl.classList.remove('shake', 'flash');
                if (oldState) {
                    setTimeout(() => { isIdle = true; updateView(); }, 500);
                }
            }, 300);
        }

        // åˆå§‹åŒ–
        changeZ(0); 
        startAnimation();
    </script>
</body>
</html>
